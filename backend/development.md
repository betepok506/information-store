# Инструкция по разработке

## Запуск

Скопировать файл `.env.example` и вставить его как `.env`

При разработке в VSCode с помощью devcontainers установить расширение `Dev Containers`

Для работы с ElaticSearch
Расширение ria.elastic

Перед запуском:

Если это первый запуск и база данных не создана:
```
alembic revision --autogenerate
alembic upgrade head
```

Для актуализации структуры базы данных:
```
alembic upgrade head
```

Запуск сервера осуществляется из консоли внутри devcontainer. Команда:
```
gunicorn -w 3 -k uvicorn.workers.UvicornWorker app.main:app  --bind 0.0.0.0:8000 --preload --log-level=debug --timeout 120
```

## Управление зависимостями

Управление зависимостями проекта осуществляется с помощью пакетного менеджера `poetry`

Для добавления новой бибилиотеки необходимо выполнить команду:
```
poetry add <LIB_NAME>
```

Для обновления версий зависимостей:
```
poetry update 

# Для обновления определенных пакетов:
poetry update <LIB_NAME> <LIB_NAME>
```

Метод может принимать дополнительные параметры:

- --no-dev : игнорирует обновление dev пакетов
- --lock : не устанавливает и не обновляет пакеты, а только обновляет файл poetry.lock

Для удаления зависимостей из проекта:
```
poetry remove <LIB_NAME>
```


## Автоматизация работы Makefile

Для автоматизации работы с проектом используется Makefile, который представляет следующий набор команд:

- **help** Показать справку
- **show** Вывод информации о текущем виртуальном окружении
- **install** Установка всех зависимостей проекта в режиме "Разработка"
- **fmt** Форматирование кода с использованием `black` & `isort`.
- **lint** Линтер кода с использованием `pep8`, `black`, `mypy linters`.
- **test** Запуск тестов и генерация отчета о покрытии 
- **watch** Запуск тестов при каждом изменении
- **clean** Удалить неиспользуемые файлы
- **virtualenv** Создать виртуальное окружение
- **release** Создать новый тег для выпуска
- **docs-generate** Генерирование документации с использованием `Sphinx`
- **docs-build** Сборка документации с использованием `Sphinx`
- **switch-to-poetry** Изменить пакетный менеджер с `pip` на `poetry`


## Правила именования веток

Варианты именования веток:
- main/master – основная стабильная версия
- develop – интеграция новых изменений
- feature/имя-функциональности или feature/123-описание
- bugfix/описание-ошибки или bugfix/123-описание
- hotfix/критическая-ошибка или hotfix/123-описание
- release/версия (например, release/1.0.0 или release/2.0.0-beta)

Дополнительные варианты для других задач:
- refactor/описание – переписывание кода
- style/описание – улучшение стиля кода
- docs/описание – обновление документации
- test/описание – добавление или изменение тестов

## Elastic Search

Запрос элемента с Elastic по id
```
curl -X GET   http://elastic_search:9200/text_vectors/_doc/{id}   -H 'Content-Type: application/json
```

Вывод всеъ элементов:
```
curl -X GET   http://localhost:9200/text_vectors/_search   -H 'Content-Type: application/json'
```
